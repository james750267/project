#--------------------------------------------------------------------------------------------------
#   File name	: test_run.tcl
#   Project		: DSP Training
#   Author		: Nguyen Tuan Phuoc
#   Description	: Running the functional simution of fsk_modulation
#
#   Referents	: none.
#
#   Confidential
#   All rights reserved
#   ICDREC Copyright (C) 2013
#--------------------------------------------------------------------------------------------------
    
    #----------------------------------------------------------------------------------------------
    #   Clear the test_run folders – Only Option
    #----------------------------------------------------------------------------------------------
#    if {[file isdirectory test_run]} {
#        file delete -force test_run
#    }
#    file mkdir test_run
    cd "./test_run"

    #----------------------------------------------------------------------------------------------
    #   Copy .txt to set initial data for ROM
    #----------------------------------------------------------------------------------------------
#    file copy -force "../../../src/matlab/sin128_data.txt" "./"
#    file copy -force "../../../src/matlab/sin64_data.txt" "./"
    
    #----------------------------------------------------------------------------------------------
    #   Clear the rtl_lib and tb_lib folders
    #----------------------------------------------------------------------------------------------
    if {[file isdirectory rtl_dir]} {
        file delete -force rtl_dir
    }

    if {[file isdirectory tb_dir]} {
        file delete -force tb_dir
    }

    #----------------------------------------------------------------------------------------------
    #   Create the rtl_lib and tb_lib folders before mapping the referencing names
    #----------------------------------------------------------------------------------------------
    vlib rtl_dir
    vmap rtl_lib rtl_dir
    
    vlib tb_dir
    vmap tb_lib tb_dir
    
    #----------------------------------------------------------------------------------------------
    #   Compilation of verilog files
    #----------------------------------------------------------------------------------------------
    set rtl_path ".."
    set tb_path ".."
    
    vlog -timescale 1ns/1ns -vlog01compat -work rtl_lib "$rtl_path/riscv_branch_comp.v"
    vlog -timescale 1ns/1ns -vlog01compat -work tb_lib  "$tb_path/test.v"
    
    #----------------------------------------------------------------------------------------------
    #   Running the simulation
    #----------------------------------------------------------------------------------------------
    vsim -novopt -t ns -wlf "testbench_wav.wlf" -L rtl_lib -L tb_lib tb_lib.test
    log -r /*
    run 500ns

    #----------------------------------------------------------------------------------------------
    #   Quit the simulation
    #----------------------------------------------------------------------------------------------
    quit -sim

    #----------------------------------------------------------------------------------------------
    #   Return to the original folder
    #----------------------------------------------------------------------------------------------
    cd ../
    
    #----------------------------------------------------------------------------------------------
    #   Quit the ModelSim
    #----------------------------------------------------------------------------------------------
    quit -f
    
    
    
